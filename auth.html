<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Auth Redirect ‚Ä¢ Ryttr</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { 
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
      text-align: center; padding: 2rem; background:#0b0f19; color:#fff; 
    }
    .card { 
      background:#121826; border-radius:12px; padding:20px; max-width:420px; margin:auto; 
      border:1px solid rgba(255,255,255,.1); 
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>üîÑ Signing you in‚Ä¶</h1>
    <p id="msg">Please wait a moment</p>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const { createClient } = supabase;
    const db = createClient(
      "https://fuiuaiquuhhsxrhzwtoa.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ1aXVhaXF1dWhoc3hyaHp3dG9hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0OTA3NjAsImV4cCI6MjA3NTA2Njc2MH0.fVM46kXmEx-SuzXOzHwOgeXEKSp4qgS-wFWKQZf-4WY"
    );

    const msg = document.getElementById("msg");

    async function finishLogin() {
      try {
        // Handle both query string and hash formats from Supabase
        const query = window.location.search;
        const hash = window.location.hash;

        if (query.includes("code=")) {
          await db.auth.exchangeCodeForSession({ queryString: query });
        } else if (hash.includes("access_token")) {
          await db.auth.exchangeCodeForSession({ queryString: hash.substring(1) });
        }

        const { data, error } = await db.auth.getUser();
        if (error) throw error;

        if (data.user) {
          msg.textContent = "‚úÖ Signed in as " + (data.user.email || "your account");
          setTimeout(() => {
            window.location.href = "/demo-yt-transcript.html";
          }, 1000);
        } else {
          throw new Error("No active session. Please log in again.");
        }
      } catch (e) {
        msg.textContent = "‚ùå Login issue: " + (e.message || e);
        msg.insertAdjacentHTML("beforeend", `<br><a href="/login.html" style="color:#5b9cff;">Try again</a>`);
      }
    }

    finishLogin();
  </script>
</body>
</html>          await db.auth.exchangeCodeForSession({ queryString: window.location.hash.substring(1) });
        }

        const { data, error } = await db.auth.getUser();
        if (error) throw error;
        if (!data.user) throw new Error("No active session");

        msg.textContent = "Signed in as " + (data.user.email || "your account") + ". Redirecting to demo";
        // Small delay so the user sees the success, then go to demo
        setTimeout(() => {
          window.location.href = "/demo-yt-transcript.html";
        }, 800);
      } catch (e) {
        msg.textContent = "Login issue: " + (e.message || e);
        // Fallback link
        const a = document.createElement("a");
        a.href = "/login.html";
        a.style.color = "#5b9cff";
        a.textContent = " Try again";
        msg.appendChild(a);
      }
    }

    finishLogin();
  </script>
</body>
</html>
